diff -Nur Mail-SpamAssassin-3.4.1/spamc/getopt.c Mail-SpamAssassin-3.4.1-new/spamc/getopt.c
--- Mail-SpamAssassin-3.4.1/spamc/getopt.c	2015-04-28 15:56:59.000000000 -0400
+++ Mail-SpamAssassin-3.4.1-new/spamc/getopt.c	2018-04-26 14:09:22.784951966 -0400
@@ -244,19 +244,26 @@
       longoptlen = strlen(longopt) - 2;
       if((bp = strchr(longopt, '='))) {
          opt = strdup(bp+1);
+         if (opt == NULL) {
+            err(1, NULL);
+         }
          longoptlen -= strlen(bp);
       }
 
       for(i=0; ; i++) {
-	 /* changed to longopts[i].name[0] == 0 - bug 7148 */
-         if((longopts[i].name == NULL) || (longopts[i].name[0] == 0))
+	 /* changed to longopts[i].name[0] == 0 - bug 7148 */         
+         if((longopts[i].name == NULL) || (longopts[i].name[0] == 0)) {
+            free(opt);
             return(longoptiserr(argc, argv, spamc_optind-1, OPTERRNF));
-         if((memcmp(longopt+2, longopts[i].name, longoptlen)) == 0) {
+         }
+         if((strncmp(longopt+2, longopts[i].name, longoptlen)) == 0) {
             *longindex = i;
             if(longopts[i].has_arg == required_argument) {
                if(((spamc_optind >= argc) || (!argv[spamc_optind]) || (argv[spamc_optind][0] == '-')) && 
-                   (opt == NULL))
+                   (opt == NULL)) {
+                  free(opt);
                   return(longoptiserr(argc, argv, spamc_optind-1, OPTERRARG));
+               }
                if(opt != NULL) {
                   spamc_optarg = opt;
                } else {
@@ -272,6 +279,7 @@
                   }
                }
             }
+            free(opt);
             if(longopts[i].flag == NULL) {
                return(longopts[i].val);
             } else {
